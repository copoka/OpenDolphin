##------------------------------------- start
#set ($top = $root.getRootElement())
#set ($patient = $top.getChild("patient"))
#set ($docInfo = $top.getChild("docInfo"))
#set ($confirmDate = $docInfo.getChildTextTrim("confirmDate"))
#set ($creator = $docInfo.getChild("creator"))
#set ($claimInfo = $docInfo.getChild("claimInfo"))
#set ($modules = $top.getChildren("module"))
##------------------------------------- start template
<?xml version="1.0" encoding="UTF-8"?> 
<Mml version="2.3" createDate="${confirmDate}" 
	xmlns:xhtml="http://www.w3.org/1999/xhtml" 
	xmlns:mmlCm="http://www.medxml.net/MML/SharedComponent/Common/1.0" 
	xmlns:mmlNm="http://www.medxml.net/MML/SharedComponent/Name/1.0" 
	xmlns:mmlFc="http://www.medxml.net/MML/SharedComponent/Facility/1.0" 
	xmlns:mmlDp="http://www.medxml.net/MML/SharedComponent/Department/1.0" 
	xmlns:mmlAd="http://www.medxml.net/MML/SharedComponent/Address/1.0" 
	xmlns:mmlPh="http://www.medxml.net/MML/SharedComponent/Phone/1.0" 
	xmlns:mmlPsi="http://www.medxml.net/MML/SharedComponent/PersonalizedInfo/1.0" 
	xmlns:mmlCi="http://www.medxml.net/MML/SharedComponent/CreatorInfo/1.0" 
	xmlns:mmlPi="http://www.medxml.net/MML/ContentModule/PatientInfo/1.0" 
	xmlns:mmlBc="http://www.medxml.net/MML/ContentModule/BaseClinic/1.0" 
	xmlns:mmlFcl="http://www.medxml.net/MML/ContentModule/FirstClinic/1.0" 
	xmlns:mmlHi="http://www.medxml.net/MML/ContentModule/HealthInsurance/1.1" 
	xmlns:mmlLs="http://www.medxml.net/MML/ContentModule/Lifestyle/1.0" 
	xmlns:mmlPc="http://www.medxml.net/MML/ContentModule/ProgressCourse/1.0" 
	xmlns:mmlRd="http://www.medxml.net/MML/ContentModule/RegisteredDiagnosis/1.0" 
	xmlns:mmlSg="http://www.medxml.net/MML/ContentModule/Surgery/1.0" 
	xmlns:mmlSm="http://www.medxml.net/MML/ContentModule/Summary/1.0" 
	xmlns:mmlLb="http://www.medxml.net/MML/ContentModule/test/1.0" 
	xmlns:mmlRp="http://www.medxml.net/MML/ContentModule/report/1.0" 
	xmlns:mmlRe="http://www.medxml.net/MML/ContentModule/Referral/1.0" 
	xmlns:mmlSc="http://www.medxml.net/MML/SharedComponent/Security/1.0" 
	xmlns:claim="http://www.medxml.net/claim/claimModule/2.1" 
	xmlns:claimA="http://www.medxml.net/claim/claimAmountModule/2.1">
	<MmlHeader>
		<mmlCi:CreatorInfo>
			<mmlPsi:PersonalizedInfo>
				<mmlCm:Id mmlCm:type="local" mmlCm:tableId="MML0024">${creator.getChildTextTrim("id")}</mmlCm:Id> 
				<mmlPsi:personName>
					<mmlNm:Name mmlNm:repCode="I" mmlNm:tableId="MML0025">
						<mmlNm:fullname>${creator.getChildTextTrim("kanjiName")}</mmlNm:fullname>
					</mmlNm:Name>
				</mmlPsi:personName>
				<mmlFc:Facility>
					<mmlFc:name mmlFc:repCode="I" mmlFc:tableId="MML0025">${creator.getChild("organization").getChildTextTrim("name")}</mmlFc:name> 
					<mmlCm:Id mmlCm:type="JMARI" mmlCm:tableId="MML0027">${creator.getChild("organization").getChildTextTrim("id")}</mmlCm:Id> 
				</mmlFc:Facility>
				<mmlDp:Department>
					<mmlDp:name mmlDp:repCode="I" mmlDp:tableId="MML0025">${claimInfo.getChildTextTrim("department")}</mmlDp:name> 
					<mmlCm:Id mmlCm:type="medical" mmlCm:tableId="MML0028">${claimInfo.getChildTextTrim("departmentId")}</mmlCm:Id> 
				</mmlDp:Department>
				<mmlPsi:addresses>
					<mmlAd:Address mmlAd:repCode="I" mmlAd:tableId="MML0025">
						<mmlAd:full>${creator.getChild("organization").getChild("address").getChildTextTrim("address")}</mmlAd:full> 
						<mmlAd:zip>${creator.getChild("organization").getChild("address").getChildTextTrim("zipCode")}</mmlAd:zip> 
					</mmlAd:Address>
				</mmlPsi:addresses>
			</mmlPsi:PersonalizedInfo>
			<mmlCi:creatorLicense mmlCi:tableId="MML0026">${creator.getChildTextTrim("license")}</mmlCi:creatorLicense> 
		</mmlCi:CreatorInfo>
		<masterId>
  			<mmlCm:Id mmlCm:type="facility" mmlCm:tableId="MML0024">${patient.getChildTextTrim("id")}</mmlCm:Id> 
		</masterId>
		<toc>
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Common/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Name/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Facility/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Department/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Address/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Phone/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/PersonalizedInfo/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/CreatorInfo/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/SharedComponent/Security/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/PatientInfo/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/BaseClinic/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/FirstClinic/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/HealthInsurance/1.1</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/Lifestyle/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/ProgressCourse/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/RegisteredDiagnosis/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/Surgery/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/Summary/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/test/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/report/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/MML/ContentModule/Referral/1.0</tocItem> 
  			<tocItem>http://www.medxml.net/claim/claimModule/2.1</tocItem> 
  			<tocItem>http://www.medxml.net/claim/claimAmountModule/2.1</tocItem> 
		</toc>
	</MmlHeader>
	<MmlBody>
		<MmlModuleItem>
			<docInfo contentModuleType="claim">
				<securityLevel>
					<accessRight permit="all">
						<mmlSc:facility>
							<mmlSc:facilityName mmlSc:facilityCode="creator">ãLç⁄é“é{ê›</mmlSc:facilityName> 
						</mmlSc:facility>
					</accessRight>
				</securityLevel>
				<title generationPurpose="record">${docInfo.getChildTextTrim("title")}</title> 
				<docId>
  					<uid>${claimInfo.getChildTextTrim("uid")}</uid> 
  					<groupId groupClass="record">${docInfo.getChildTextTrim("docId")}</groupId> 
				</docId>
				<confirmDate>${confirmDate}</confirmDate> 
				<mmlCi:CreatorInfo>
					<mmlPsi:PersonalizedInfo>
  						<mmlCm:Id mmlCm:type="local" mmlCm:tableId="MML0024">${creator.getChildTextTrim("id")}</mmlCm:Id> 
							<mmlPsi:personName>
								<mmlNm:Name mmlNm:repCode="I" mmlNm:tableId="MML0025">
  									<mmlNm:fullname>${creator.getChildTextTrim("kanjiName")}</mmlNm:fullname> 
								</mmlNm:Name>
							</mmlPsi:personName>
						<mmlFc:Facility>
  						<mmlFc:name mmlFc:repCode="I" mmlFc:tableId="MML0025">${creator.getChild("organization").getChildTextTrim("name")}</mmlFc:name> 
  							<mmlCm:Id mmlCm:type="JMARI" mmlCm:tableId="MML0027">${creator.getChild("organization").getChildTextTrim("id")}</mmlCm:Id> 
  						</mmlFc:Facility>
						<mmlDp:Department>
  							<mmlDp:name mmlDp:repCode="I" mmlDp:tableId="MML0025">${claimInfo.getChildTextTrim("department")}</mmlDp:name> 
  							<mmlCm:Id mmlCm:type="medical" mmlCm:tableId="MML0028">${claimInfo.getChildTextTrim("departmentId")}</mmlCm:Id> 
  						</mmlDp:Department>
						<mmlPsi:addresses>
							<mmlAd:Address mmlAd:repCode="I" mmlAd:tableId="MML0025">
  								<mmlAd:full>${creator.getChild("organization").getChild("address").getChildTextTrim("address")}</mmlAd:full> 
  								<mmlAd:zip>${creator.getChild("organization").getChild("address").getChildTextTrim("zipCode")}</mmlAd:zip> 
  							</mmlAd:Address>
  						</mmlPsi:addresses>
  					</mmlPsi:PersonalizedInfo>
  					<mmlCi:creatorLicense mmlCi:tableId="MML0026">${creator.getChildTextTrim("license")}</mmlCi:creatorLicense> 
  				</mmlCi:CreatorInfo>
  				<extRefs /> 
  			</docInfo>
		<content>
			<claim:ClaimModule>
##------------------------------------- start information
				<claim:information claim:status="perform"
                                   claim:orderTime="${confirmDate}"
                                   claim:admitFlag="false"
#if ($claimInfo.getChild("insuranceUid"))
                                   claim:insuranceUid="${claimInfo.getChildTextTrim("insuranceUid")}"
#end   
                                   claim:defaultTableId="dolphin_2001_10_03">
					<mmlHi:insuranceClass mmlHi:ClassCode="${claimInfo.getChildTextTrim("insuranceClassCode")}" mmlHi:tableId="MML0031">${claimInfo.getChildTextTrim("insuranceClass")}</mmlHi:insuranceClass>    
				</claim:information>
##------------------------------------- end information
##------------------------------------- start bundle	
#foreach ($module in $modules)
#set ($bundle = false)
#set ($bundle = $module.getChild("model").getChild("bundleMed"))
#if ($bundle)
#set ($adminMemo = false)
#set ($classCode = $bundle.getChildTextTrim("classCode"))
#set ($classCodeId = "Claim007")
#set ($className = $bundle.getChildTextTrim("className"))
#set ($adminCode = $bundle.getChildTextTrim("adminCode"))
#set ($admin     = $bundle.getChildTextTrim("admin"))
#set ($adminMemo = $bundle.getChildTextTrim("adminMemo"))
#set ($bundleNumber = $bundle.getChildTextTrim("bundleNumber"))

				<claim:bundle claim:classCode="${classCode}" claim:classCodeId="${classCodeId}">
					<claim:className>${className}</claim:className>
					<claim:administration claim:adminCode="${adminCode}">${admin}</claim:administration>
#if ($adminMemo)
					<claim:admMemo>${adminMemo}</claim:admMemo>
#end	    
					<claim:bundleNumber>${bundleNumber}</claim:bundleNumber>
##------------------------------------- start item	    
#set ($items = $bundle.getChildren("claimItem"))
#foreach ($item in $items)
#set ($unit = false)
#set ($subclassCode   = $item.getChildTextTrim("classCode"))
#set ($subclassCodeId = "Claim003")
#set ($code           = $item.getChildTextTrim("code"))
#set ($name           = $item.getChildTextTrim("name"))
#set ($numberCode     = $item.getChildTextTrim("numberCode"))
#set ($numberCodeId   = "Claim004")
#set ($unit           = $item.getChildTextTrim("unit"))
#set ($number         = $item.getChildTextTrim("number"))

					<claim:item claim:subclassCode="${subclassCode}"
                                claim:subclassCodeId="${subclassCodeId}"
                                claim:code="${code}">
						<claim:name>${name}</claim:name>
	    				<claim:number claim:numberCode="${numberCode}" claim:numberCodeId="${numberCodeId}"
#if ($unit)	        	              
                                      claim:unit="${unit}"
#end	                          
	                                            >${number}</claim:number>
					</claim:item>
#end
##------------------------------------- end item
#if ($bundle.getChild("memo"))	 
					<claim:memo>${bundle.getChildTextTrim("memo")}</claim:memo>
#end	    
				</claim:bundle>
#else
#set ($bundle = $module.getChild("model").getChild("bundleDolphin"))
#if ($bundle)
#set ($classCode = $bundle.getChildTextTrim("classCode"))
#set ($classCodeId = "Claim007")
#set ($className = $bundle.getChildTextTrim("className"))
#set ($bundleNumber = $bundle.getChildTextTrim("bundleNumber"))

				<claim:bundle claim:classCode="${classCode}" claim:classCodeId="${classCodeId}">
					<claim:className>${className}</claim:className>					
					<claim:bundleNumber>${bundleNumber}</claim:bundleNumber>
##------------------------------------- start item	    
#set ($items = $bundle.getChildren("claimItem"))
#foreach ($item in $items)
#set ($numberCode     = false )
#set ($unit           = false )
#set ($number         = false )
#set ($subclassCode   = $item.getChildTextTrim("classCode"))
#set ($subclassCodeId = "Claim003")
#set ($code           = $item.getChildTextTrim("code"))
#set ($name           = $item.getChildTextTrim("name"))
#set ($numberCode     = $item.getChildTextTrim("numberCode"))
#set ($numberCodeId   = "Claim004")
#set ($unit           = $item.getChildTextTrim("unit"))
#set ($number         = $item.getChildTextTrim("number"))
	
					<claim:item claim:subclassCode="${subclassCode}"
                                claim:subclassCodeId="${subclassCodeId}"
                                claim:code="${code}">
						<claim:name>${name}</claim:name>
#if ($number)						
	    				<claim:number claim:numberCode="${numberCode}" claim:numberCodeId="${numberCodeId}"
#if ($unit)	        	              
                                      claim:unit="${unit}"
#end	                          
	                                            >${number}</claim:number>
#end	                                            
					</claim:item>
#end
##------------------------------------- end item
#if ($bundle.getChild("memo"))	 
					<claim:memo>${bundle.getChildTextTrim("memo")}</claim:memo>
#end	    
				</claim:bundle>
#end
#end	
#end	
##------------------------------------- end bundle	
			</claim:ClaimModule>
		</content>
	</MmlModuleItem>
</MmlBody>
</Mml>